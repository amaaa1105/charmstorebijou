<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Charm Store ‚Äî —É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</title>
  <meta name="description" content="Charm Store ‚Äî –Ω–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –ö–∞—Ç–∞–ª–æ–≥, –∫–æ—Ä–∑–∏–Ω–∞ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–≤–æ–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–¥–µ–ª–∏—è ‚ú®"/>
  <link id="favicon" rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23F7C9D4'/%3E%3Cstop offset='1' stop-color='%23F5E9E2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='128' height='128' fill='url(%23g)'/%3E%3Ctext x='50%25' y='55%25' text-anchor='middle' font-family='Arial' font-size='54' fill='black'%3ECS%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --pink:#F7C9D4; --beige:#F5E9E2; --white:#fff; --ink:#000;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--beige),var(--white) 40%)}
    .container{width:min(1100px,92%);margin:0 auto}
    .btn{border:1px solid var(--ink);background:var(--pink);color:var(--ink);border-radius:999px;padding:10px 18px;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
    .btn-outline{background:transparent}
    .btn-primary{background:var(--pink)}
    .btn.small{padding:6px 10px;border-radius:8px}
    .btn.icon{display:inline-flex;align-items:center;gap:6px}
    .btn.danger{background:#fff3f3;border-color:#af1e1e}

    /* Header + Nav */
    .site-header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.75);backdrop-filter:blur(8px);border-bottom:1px solid #00000010}
    .header-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .avatar{width:36px;height:36px;border-radius:50%;border:1px solid #00000030;object-fit:cover;background:#fff}
    .brand-name{margin:0;font-size:20px}
    .brand-tag{margin:0;font-size:12px;opacity:.8}
    .nav{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .nav a, .nav button.link{color:var(--ink);text-decoration:none;padding:8px 12px;border-radius:10px;border:1px solid #00000015;background:#fff}
    .nav a:hover,.nav button.link:hover{background:var(--beige)}
    .cart-pill{display:inline-flex;align-items:center;gap:6px}

    /* Sections */
    section{scroll-margin-top:80px}
    .hero{padding:34px 0}
    .hero-inner{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:center}
    @media(max-width:900px){.hero-inner{grid-template-columns:1fr}}
    .hero-card{background:var(--white);border:1px solid #00000010;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .hero-img{height:220px;border-radius:10px;border:1px dashed #00000040;background:radial-gradient(100px 100px at 20% 30%, #ffffffcc, transparent), linear-gradient(135deg,var(--pink),var(--beige)); background-size: cover; background-position: center;}
    .section{padding:32px 0}
    .section-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
    .section-head h3{margin:0;font-size:26px}
    .muted{opacity:.8}

    /* Tabs (hash nav) */
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
    .tab{border:1px solid #00000020;background:#fff;border-radius:999px;padding:8px 14px;text-decoration:none;color:var(--ink)}
    .tab.active,.tab:hover{background:var(--beige)}

    /* Catalog */
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin:0 0 14px}
    .filter-btn{border:1px solid var(--ink);background:transparent;border-radius:999px;padding:8px 12px;cursor:pointer}
    .filter-btn.active,.filter-btn:hover{background:var(--beige)}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media(max-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:480px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #00000012;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card-img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#fff;border-bottom:1px solid #00000010}
    .card-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .qty{display:inline-flex;align-items:center;border:1px solid #00000030;border-radius:10px;overflow:hidden}
    .qty button{background:#fff;border:0;padding:6px 10px;cursor:pointer}
    .qty input{width:44px;text-align:center;border:0;padding:6px 0}

    /* Constructor */
    .constructor .wrap{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media(max-width:900px){.constructor .wrap{grid-template-columns:1fr}}
    .panel{background:#fff;border:1px solid #00000010;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #00000030;border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer}
    .chip .dot{width:18px;height:18px;border-radius:50%;border:1px solid #00000040}
    .chip.active,.chip:hover{background:var(--beige)}
    .beads{display:flex;flex-wrap:wrap;gap:8px}
    .bead{display:flex;align-items:center;gap:6px;border:1px solid #00000030;border-radius:999px;padding:6px 10px;background:#fff}
    .bead .sw{width:16px;height:16px;border-radius:50%;border:1px solid #00000040}
    .strand{display:flex;flex-wrap:wrap;gap:8px;min-height:56px;border:1px dashed #00000030;border-radius:12px;padding:10px;background:#fff}
    .bead-pill{display:flex;align-items:center;gap:6px;border:1px solid #00000030;border-radius:999px;padding:6px 8px;background:#fff}
    .bead-pill .sw{width:14px;height:14px;border-radius:50%;border:1px solid #00000040}
    .pill-actions button{border:1px solid #00000030;background:transparent;border-radius:6px;padding:2px 6px;cursor:pointer}
    .totals{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .badge{border:1px solid #00000030;padding:6px 10px;border-radius:999px;background:#fff}
    .note{font-size:12px;opacity:.8}

    /* New styles for visualizer */
    .visualizer-wrapper{margin-top:20px;padding-bottom:10px;border-bottom:1px solid #ddd}
    .visualizer{
      width:100%; height:40px; margin:20px 0; background-image:linear-gradient(90deg,#00000020 1px,transparent 1px),linear-gradient(90deg,#00000020 1px,transparent 1px);
      background-size:20px 100%,10px 100%;
      background-position:0 0, 10px 0;
      background-repeat:repeat-x;
      position:relative;
      overflow-x:auto;
      white-space:nowrap;
      display:flex;
      align-items:center;
      gap:0;
    }
    .visualizer-bead{
      flex-shrink:0;
      border-radius:50%;
      box-shadow:0 1px 3px rgba(0,0,0,.3);
      border:1px solid #00000020;
      position:relative;
    }
    .visualizer-info{position:absolute;top:100%;left:0;margin-top:6px;font-size:12px;color:var(--ink);opacity:.8;display:none}
    .visualizer-bead:hover .visualizer-info{display:block}
    .visualizer-bead.active{border:2px solid var(--pink)}
    .progress-bar{
      position:absolute;
      left:0;
      top:50%;
      height:2px;
      background:var(--pink);
      transition:width .3s ease;
      transform:translateY(-50%);
    }

    /* Cart */
    .cart-table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #00000015;border-radius:12px;overflow:hidden}
    .cart-table th,.cart-table td{padding:10px;border-bottom:1px solid #00000010;text-align:left;vertical-align:middle}
    .cart-total{display:flex;justify-content:flex-end;gap:12px;align-items:center;margin-top:12px}
    .empty{opacity:.7;text-align:center;padding:20px}

    /* Footer */
    .site-footer{border-top:1px solid #00000010;padding:16px 0;background:rgba(255,255,255,.6);margin-top:24px}
    .footer-inner{display:flex;align-items:center;justify-content:space-between}

    /* Floating WhatsApp */
    .fab-wa{position:fixed;right:16px;bottom:16px;z-index:40;border:1px solid var(--ink);background:var(--pink);padding:12px 16px;border-radius:999px;text-decoration:none;color:var(--ink);box-shadow:var(--shadow)}
    .fab-wa:hover{transform:translateY(-1px)}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img id="avatar" class="avatar" alt="–ê–≤–∞—Ç–∞—Ä"/>
        <div>
          <h1 class="brand-name">Charm Store ‚ú®</h1>
          <p class="brand-tag">—É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ä¢ —Å–æ–∑–¥–∞–≤–∞–π —Å–≤–æ—ë üéÄ</p>
        </div>
      </div>
      <nav class="nav">
        <a href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
        <a href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
        <a href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        <button id="openAddModal" class="link">–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ</button>
        <button id="setAvatarBtn" class="link">–ê–≤–∞—Ç–∞—Ä</button>
        <input id="avatarFile" type="file" accept="image/*" hidden/>
        <button id="openCart" class="link cart-pill">üß∫ –ö–æ—Ä–∑–∏–Ω–∞ <span id="cartCount" class="badge" style="margin-left:6px">0</span></button>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" id="home">
      <div class="container hero-inner">
        <div>
          <h2>–ù–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è + –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π ‚ú®</h2>
          <p class="muted">–ë–µ–ª—ã–µ, —Ä–æ–∑–æ–≤—ã–µ –∏ –±–µ–∂–µ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏, –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ—ë –æ–∂–µ—Ä–µ–ª—å–µ, –±—Ä–∞—Å–ª–µ—Ç –∏–ª–∏ –±—Ä–µ–ª–æ–∫ ‚Äî –æ–Ω–ª–∞–π–Ω, –∫–∞–∫ –≤–∂–∏–≤—É—é.</p>
          <div class="tabs">
            <a class="tab" href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
            <a class="tab" href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a class="tab" href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
            <a class="tab" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
          </div>
        </div>
        <div class="hero-card">
          <div id="heroImg" class="hero-img" role="img" aria-label="–ü–∞—Å—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —É–∫—Ä–∞—à–µ–Ω–∏–π"></div>
        </div>
      </div>
    </section>

    <section class="section" id="about">
      <div class="container">
        <div class="section-head">
          <h3>–û –Ω–∞—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ üéÄ</h3>
          <div class="row">
            <button id="editAboutBtn" class="btn btn-outline small">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>
        <div id="aboutContent" style="line-height:1.6"></div>
      </div>
    </section>

    <section class="section" id="catalog">
      <div class="container">
        <div class="section-head">
          <h3>–ö–∞—Ç–∞–ª–æ–≥ ‚ú®</h3>
          <div class="row muted">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ ¬´–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ¬ª. –§–æ—Ç–æ/—Ç–µ–∫—Å—Ç —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</div>
        </div>
        <div class="filters">
          <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
          <button class="filter-btn" data-filter="bracelets">–ë—Ä–∞—Å–ª–µ—Ç—ã</button>
          <button class="filter-btn" data-filter="necklaces">–û–∂–µ—Ä–µ–ª—å—è</button>
          <button class="filter-btn" data-filter="rings">–ö–æ–ª—å—Ü–∞</button>
          <button class="filter-btn" data-filter="earrings">–°–µ—Ä—å–≥–∏</button>
          <button class="filter-btn" data-filter="chains">–¶–µ–ø–æ—á–∫–∏</button>
          <button class="filter-btn" data-filter="keychains">–ë—Ä–µ–ª–∫–∏</button>
        </div>
        <div id="productsGrid" class="grid"></div>
        <p id="emptyState" class="empty">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ¬ª, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ.</p>
      </div>
    </section>

    <section class="section constructor" id="builder">
      <div class="container">
        <div class="section-head">
          <h3>–°–æ–∑–¥–∞–π —Å–≤–æ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ üí´</h3>
          <div class="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø, –¥–ª–∏–Ω—É –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã. –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –±—É—Å–∏–Ω—ã ‚Äî –æ–Ω–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –Ω–∞ ¬´–Ω–∏—Ç—å¬ª. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏ —É–¥–∞–ª—è—Ç—å.</div>
        </div>

        <div class="wrap">
          <div class="panel">
            <div class="row" style="margin-bottom:6px"><span class="muted">–¢–∏–ø –∏–∑–¥–µ–ª–∏—è:</span></div>
            <div class="row" id="typeRow">
              <button class="chip" data-type="keychain"><span class="dot"></span>–ë—Ä–µ–ª–æ–∫</button>
              <button class="chip" data-type="bracelet"><span class="dot"></span>–ë—Ä–∞—Å–ª–µ—Ç</button>
              <button class="chip" data-type="necklace"><span class="dot"></span>–û–∂–µ—Ä–µ–ª—å–µ</button>
            </div>

            <div class="row" style="margin:10px 0 6px"><span class="muted">–î–ª–∏–Ω–∞ (—Å–º):</span></div>
            <div class="row" id="sizeRow">
              <button class="chip" data-size="keychain:12">12</button>
              <button class="chip" data-size="bracelet:16">16</button>
              <button class="chip" data-size="bracelet:17">17</button>
              <button class="chip" data-size="bracelet:19">19</button>
              <button class="chip" data-size="necklace:40">40</button>
              <button class="chip" data-size="necklace:45">45</button>
              <button class="chip" data-size="necklace:50">50</button>
            </div>

            <div class="row" style="margin:10px 0 6px"><span class="muted">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span></div>
            <div id="beadsList" class="beads"></div>

            <div class="row" style="margin-top:10px">
              <button id="addCustomBead" class="btn btn-outline small">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª</button>
              <button id="resetMaterials" class="btn btn-outline small">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            </div>
            <p class="note">–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–ñ–µ–º—á—É–≥ –ú–∞–π–æ—Ä–∫–∞ 8–º–º¬ª, —Ü–µ–Ω–∞ –∏ —Ü–≤–µ—Ç). –ü–æ—Ç–æ–º –æ–Ω–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ.</p>
          </div>

          <div class="panel">
            <div class="row" style="justify-content:space-between;align-items:center">
              <strong>–í–∞—à –¥–∏–∑–∞–π–Ω ‚Äî –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∏—Ç–∏</strong>
              <div class="row">
                <button id="clearDesign" class="btn btn-outline small">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="exportDesign" class="btn btn-outline small">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <input id="importFile" type="file" accept="application/json" hidden/>
                <button id="importDesign" class="btn btn-outline small">–ò–º–ø–æ—Ä—Ç</button>
              </div>
            </div>

            <div id="beadVisualizer" class="visualizer-wrapper">
                <div class="visualizer">
                  <div id="progressBar" class="progress-bar"></div>
                </div>
            </div>

            <div id="strand" class="strand" aria-label="–ù–∏—Ç—å —Å –±—É—Å–∏–Ω–∞–º–∏"></div>

            <div class="totals">
              <span class="badge">–¢–∏–ø: <span id="t_type">‚Äî</span></span>
              <span class="badge">–î–ª–∏–Ω–∞: <span id="t_length">‚Äî</span></span>
              <span class="badge">–ë—É—Å–∏–Ω: <span id="t_count">0</span></span>
              <span class="badge">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="t_price">0 ‚Ç∏</span></span>
            </div>

            <label class="row" style="gap:8px;margin-top:8px"><span class="muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</span>
              <input id="userNote" type="text" placeholder="–ù–∞–ø—Ä.: –∑–∞—Å—Ç—ë–∂–∫–∞ –∑–æ–ª–æ—Ç–æ, —Ä–∞–∑–º–µ—Ä 17 —Å–º" style="flex:1;padding:8px 10px;border:1px solid #00000040;border-radius:10px"/>
            </label>

            <div class="row" style="justify-content:flex-end;margin-top:8px;gap:8px">
              <button id="addDesignToCart" class="btn">üß∫ –í –∫–æ—Ä–∑–∏–Ω—É</button>
              <button id="orderWA" class="btn btn-primary">üì≤ –ó–∞–∫–∞–∑–∞—Ç—å –≤ WhatsApp</button>
            </div>

            <p class="note" style="margin-top:8px">–ü–æ–¥—Å–∫–∞–∑–∫–∏: –∂–º–∏—Ç–µ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º —Å–≤–µ—Ä—Ö—É ‚Äî –æ–Ω–∏ –¥–æ–±–∞–≤—è—Ç—Å—è –Ω–∏–∂–µ. –£ –∫–∞–∂–¥–æ–π ¬´—Ç–∞–±–ª–µ—Ç–∫–∏¬ª –µ—Å—Ç—å ‚óÄÔ∏è ‚ñ∂Ô∏è –∏ ‚úï. –¶–µ–Ω–∞ –∏ –¥–ª–∏–Ω–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="contacts">
      <div class="container">
        <div class="section-head">
          <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã ü§ç</h3>
          <div class="row">
            <button id="editIG" class="btn btn-outline small">–ò–∑–º–µ–Ω–∏—Ç—å Instagram</button>
          </div>
        </div>
        <div class="row" style="gap:12px;flex-wrap:wrap">
          <a id="igLink" class="btn" target="_blank" href="https://instagram.com/charmstore">üì∏ –ù–∞—à Instagram</a>
          <a id="waLink" class="btn btn-primary" target="_blank">üì≤ WhatsApp</a>
        </div>
      </div>
    </section>

    <section class="section" id="cartSection" style="display:none">
      <div class="container">
        <div class="section-head">
          <h3>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ üß∫</h3>
          <button id="closeCart" class="btn btn-outline small">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>

        <div id="cartEmpty" class="empty">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</div>
        <table id="cartTable" class="cart-table" style="display:none">
          <thead>
            <tr>
              <th>–¢–æ–≤–∞—Ä/–î–∏–∑–∞–π–Ω</th>
              <th>–¶–µ–Ω–∞</th>
              <th>–ö–æ–ª-–≤–æ</th>
              <th>–°—É–º–º–∞</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="cartBody"></tbody>
        </table>
        <div class="cart-total">
          <strong>–ò—Ç–æ–≥–æ:</strong> <span id="cartTotal">0 ‚Ç∏</span>
          <button id="checkoutWA" class="btn btn-primary">–û—Ñ–æ—Ä–º–∏—Ç—å –≤ WhatsApp</button>
          <button id="clearCart" class="btn btn-outline">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <span>¬©Ô∏è <span id="year"></span> Charm Store</span>
      <div>
        <a class="tab" href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
        <a class="tab" href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a class="tab" href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
        <a class="tab" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </div>
    </div>
  </footer>

  <dialog id="addModal">
    <form id="addProductForm" method="dialog" style="padding:16px;min-width:min(520px,92vw)">
      <h3 style="margin:0 0 10px">–î–æ–±–∞–≤–∏—Ç—å –∏–∑–¥–µ–ª–∏–µ –≤ –∫–∞—Ç–∞–ª–æ–≥</h3>
      <div class="row" style="gap:12px;flex-wrap:wrap">
        <label style="flex:1;display:grid;gap:6px">–ù–∞–∑–≤–∞–Ω–∏–µ
          <input type="text" name="name" required placeholder="–ù–∞–ø—Ä. Pearl Blossom"/>
        </label>
        <label style="width:160px;display:grid;gap:6px">–¶–µ–Ω–∞ (‚Ç∏)
          <input type="number" name="price" required min="0" step="10" placeholder="12000"/>
        </label>
        <label style="width:220px;display:grid;gap:6px">–ö–∞—Ç–µ–≥–æ—Ä–∏—è
          <select name="category" required>
            <option value="bracelets">–ë—Ä–∞—Å–ª–µ—Ç—ã</option>
            <option value="necklaces">–û–∂–µ—Ä–µ–ª—å—è</option>
            <option value="rings">–ö–æ–ª—å—Ü–∞</option>
            <option value="earrings">–°–µ—Ä—å–≥–∏</option>
            <option value="chains">–¶–µ–ø–æ—á–∫–∏</option>
            <option value="keychains">–ë—Ä–µ–ª–∫–∏</option>
          </select>
        </label>
      </div>
      <label style="display:grid;gap:6px;margin-top:8px">–û–ø–∏—Å–∞–Ω–∏–µ
        <textarea name="desc" rows="3" placeholder="–ú–∞—Ç–µ—Ä–∏–∞–ª—ã, —Å—Ç–∏–ª—å, —Ä–∞–∑–º–µ—Ä—ã..."></textarea>
      </label>
      <label style="display:grid;gap:6px;margin-top:8px">–§–æ—Ç–æ
        <input type="file" name="image" accept="image/*" required/>
      </label>
      <div class="row" style="justify-content:flex-end;margin-top:12px;gap:8px">
        <button class="btn btn-outline" value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="submitAdd" class="btn btn-primary" value="default">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <p class="note" style="margin-top:8px">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ LocalStorage (–≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ).</p>
    </form>
  </dialog>

  <dialog id="aboutModal">
    <form id="aboutForm" method="dialog" style="padding:16px;min-width:min(520px,92vw)">
      <h3 style="margin:0 0 10px">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ¬´–û –º–∞–≥–∞–∑–∏–Ω–µ¬ª</h3>
      <textarea id="aboutInput" rows="10" style="width:100%;padding:10px;border:1px solid #00000030;border-radius:10px"></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:12px">
        <button class="btn btn-outline" value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="saveAbout" class="btn btn-primary" value="default">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </dialog>

  <a id="fabWa" class="fab-wa" target="_blank">WhatsApp</a>

  <script>
    // ====== CONSTANTS & KEYS ======
    const YEAR = document.getElementById('year'); YEAR.textContent = new Date().getFullYear();
    const AVATAR_KEY='csAvatar', ABOUT_KEY='csAbout', IG_KEY='csIG', PRODUCTS_KEY='csProducts', CART_KEY='csCart', MATERIALS_KEY='csMaterials', DESIGN_KEY='csDesign';
    const WA_RAW = '87785094161'; // –≤–∞—à –Ω–æ–º–µ—Ä
    const WA_NUM = /^8\\d{10}$/.test(WA_RAW) ? '7'+WA_RAW.slice(1) : WA_RAW;
    const WA_URL = `https://wa.me/${WA_NUM}`;

    // ====== AVATAR & FAVICON & HERO IMG ======
    const avatarImg=document.getElementById('avatar'), setAvatarBtn=document.getElementById('setAvatarBtn'), avatarFile=document.getElementById('avatarFile'), favicon=document.getElementById('favicon');
    const heroImg=document.getElementById('heroImg');
    function placeholderSVG(label='CS'){
      const pink=getComputedStyle(document.documentElement).getPropertyValue('--pink').trim();
      const beige=getComputedStyle(document.documentElement).getPropertyValue('--beige').trim();
      const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='320' height='320'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='${pink}'/><stop offset='100%' stop-color='${beige}'/></linearGradient></defs><rect width='320' height='320' rx='28' fill='url(#g)'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Arial, sans-serif' font-size='128' fill='black' opacity='.9'>${label}</text></svg>`;
      return 'data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svg);
    }
    function loadAvatar(){ const a=localStorage.getItem(AVATAR_KEY); if(a){ avatarImg.src=a; favicon.href=a; heroImg.style.backgroundImage = `url('${a}')` } else { avatarImg.src=placeholderSVG(); heroImg.style.backgroundImage = `url('${placeholderSVG('Charm Store')}')` } }
    function saveAvatar(data){ localStorage.setItem(AVATAR_KEY,data); loadAvatar(); }
    setAvatarBtn.addEventListener('click',()=>avatarFile.click());
    avatarFile.addEventListener('change',()=>{const f=avatarFile.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>saveAvatar(r.result); r.readAsDataURL(f);});
    loadAvatar();

    // ====== ABOUT ======
    const aboutDefault = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Charm Store ‚Äî —É—é—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ –±–µ–ª—ã—Ö, —Ä–æ–∑–æ–≤—ã—Ö –∏ –±–µ–∂–µ–≤—ã—Ö –æ—Ç—Ç–µ–Ω–∫–∞—Ö ü§çüå∏
–ú—ã —Å–æ–∑–¥–∞—ë–º –Ω–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é –∏ –¥–∞—ë–º –≤–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–±—Ä–∞—Ç—å —Å–≤–æ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ –æ–Ω–ª–∞–π–Ω ‚ú®`;
    const aboutContent=document.getElementById('aboutContent'), editAboutBtn=document.getElementById('editAboutBtn'), aboutModal=document.getElementById('aboutModal'), aboutInput=document.getElementById('aboutInput'), saveAbout=document.getElementById('saveAbout');
    function renderAbout(){ const t=localStorage.getItem(ABOUT_KEY)||aboutDefault; aboutContent.innerText=t; }
    editAboutBtn.addEventListener('click',()=>{ aboutInput.value=localStorage.getItem(ABOUT_KEY)||aboutDefault; aboutModal.showModal(); });
    saveAbout.addEventListener('click',(e)=>{ e.preventDefault(); localStorage.setItem(ABOUT_KEY, aboutInput.value||aboutDefault); aboutModal.close(); renderAbout(); });
    renderAbout();

    // ====== CONTACTS ======
    const igLink=document.getElementById('igLink'), editIG=document.getElementById('editIG'), waLink=document.getElementById('waLink'), fabWa=document.getElementById('fabWa');
    function renderIG(){ const h=localStorage.getItem(IG_KEY)||'charmstore'; igLink.href=`https://instagram.com/${h}`; }
    editIG.addEventListener('click',()=>{ const cur=localStorage.getItem(IG_KEY)||'charmstore'; const next=prompt('–í–≤–µ–¥–∏—Ç–µ Instagram @username (–±–µ–∑ @):', cur); if(next){ localStorage.setItem(IG_KEY,next.replace(/^@/,'')); renderIG(); }});
    renderIG(); waLink.href=WA_URL; fabWa.href=WA_URL;

    // ====== HELPERS ======
    const money = v => (v||0).toLocaleString('ru-RU')+' ‚Ç∏';
    function fileToDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }

    // ====== CATALOG ======
    const grid=document.getElementById('productsGrid'), emptyState=document.getElementById('emptyState');
    const addModal=document.getElementById('addModal'), openAdd=document.getElementById('openAddModal'), addForm=document.getElementById('addProductForm'), submitAdd=document.getElementById('submitAdd');
    const filterBtns=[...document.querySelectorAll('.filter-btn')];
    const CATS=['bracelets','necklaces','rings','earrings','chains','keychains'];
    function getProducts(){ try{ return JSON.parse(localStorage.getItem(PRODUCTS_KEY)||'[]'); }catch(_){ return []; } }
    function saveProducts(list){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(list)); }
    function seedProducts(){
      const exists=getProducts(); if(exists.length) return;
      saveProducts([
        {id:crypto.randomUUID(), name:'Pearl Blossom', price:12000, category:'necklaces', desc:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∂–µ–º—á—É–≥, —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞ –ø–æ–¥ –∑–æ–ª–æ—Ç–æ.', image:placeholderSVG('–§–æ—Ç–æ')},
        {id:crypto.randomUUID(), name:'Minimal Chain', price:7500, category:'chains', desc:'–¢–æ–Ω–∫–∞—è —Ü–µ–ø–æ—á–∫–∞, –≥–∏–ø–æ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω–∞—è —Å—Ç–∞–ª—å.', image:placeholderSVG('–§–æ—Ç–æ')},
        {id:crypto.randomUUID(), name:'Rose Quartz', price:9900, category:'bracelets', desc:'–ë—Ä–∞—Å–ª–µ—Ç —Å —Ä–æ–∑–æ–≤—ã–º –∫–≤–∞—Ä—Ü–µ–º.', image:placeholderSVG('–§–æ—Ç–æ')},
        {id:crypto.randomUUID(), name:'Dainty Ring', price:6000, category:'rings', desc:'–ê–∫–∫—É—Ä–∞—Ç–Ω–æ–µ –∫–æ–ª—å—Ü–æ, —Ä–µ–≥—É–ª–∏—Ä—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä.', image:placeholderSVG('–§–æ—Ç–æ')}
      ]);
    }
    function productCard(p){
      const el=document.createElement('article'); el.className='card';
      const img=document.createElement('img'); img.className='card-img'; img.src=p.image||placeholderSVG('–§–æ—Ç–æ'); img.alt=p.name;
      const body=document.createElement('div'); body.className='card-body';
      const title=document.createElement('div'); title.style.fontWeight='600'; title.textContent=p.name;
      const price=document.createElement('div'); price.style.fontWeight='600'; price.textContent=money(p.price);
      const desc=document.createElement('div'); desc.className='muted'; desc.textContent=p.desc||'';
      const qtyWrap=document.createElement('div'); qtyWrap.className='row';
      const qty=document.createElement('div'); qty.className='qty';
      const minus=document.createElement('button'); minus.textContent='‚àí';
      const input=document.createElement('input'); input.type='number'; input.min='1'; input.value='1';
      const plus=document.createElement('button'); plus.textContent='+';
      minus.onclick=()=>{ const v=Math.max(1, parseInt(input.value||'1')-1); input.value=v; };
      plus.onclick=()=>{ const v=Math.max(1, parseInt(input.value||'1')+1); input.value=v; };
      qty.append(minus,input,plus);
      const addBtn=document.createElement('button'); addBtn.className='btn'; addBtn.textContent='üß∫ –í –∫–æ—Ä–∑–∏–Ω—É';
      addBtn.onclick=()=>{ addToCart({type:'product', id:p.id, name:p.name, price:p.price, qty:parseInt(input.value||'1')}); };
      qtyWrap.append(qty, addBtn);
      body.append(title, price, desc, qtyWrap);
      el.append(img, body);
      return el;
    }
    function renderCatalog(filter='all'){
      const list=getProducts();
      grid.innerHTML='';
      const shown=list.filter(p=> filter==='all' ? true : p.category===filter);
      if(shown.length===0){ emptyState.style.display='block'; } else { emptyState.style.display='none'; shown.forEach(p=>grid.appendChild(productCard(p))); }
    }
    filterBtns.forEach(b=> b.addEventListener('click', ()=>{
      filterBtns.forEach(x=>x.classList.remove('active')); b.classList.add('active'); renderCatalog(b.dataset.filter);
    }));
    openAdd.addEventListener('click',()=>addModal.showModal());
    addForm.addEventListener('submit', async (e)=>{
      if(e.submitter!==submitAdd) return; e.preventDefault();
      const fd=new FormData(addForm);
      const file=fd.get('image'); if(!file || !file.size){ alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ'); return; }
      const product={
        id: crypto.randomUUID(),
        name: fd.get('name'),
        price: Number(fd.get('price')||0),
        category: fd.get('category'),
        desc: fd.get('desc')||'',
        image: await fileToDataURL(file)
      };
      const list=getProducts(); list.unshift(product); saveProducts(list);
      addForm.reset(); addModal.close();
      const active=document.querySelector('.filter-btn.active')?.dataset.filter||'all'; renderCatalog(active);
    });

    // ====== MATERIALS (for builder, editable) ======
    function getMaterials(){
      try{ const s=localStorage.getItem(MATERIALS_KEY); if(s) return JSON.parse(s); }catch(_){}
      const base=[
        {id:'pearl-6', name:'–ñ–µ–º—á—É–≥ 6–º–º', color:'#f7f3f0', price:350, size:6, group:'–ñ–µ–º—á—É–≥'},
        {id:'pearl-8', name:'–ñ–µ–º—á—É–≥ 8–º–º', color:'#f3ede9', price:450, size:8, group:'–ñ–µ–º—á—É–≥'},
        {id:'pearl-pink', name:'–ñ–µ–º—á—É–≥ —Ä–æ–∑–æ–≤—ã–π 6–º–º', color:'#F7C9D4', price:400, size:6, group:'–ñ–µ–º—á—É–≥'},
        {id:'pearl-white', name:'–ñ–µ–º—á—É–≥ –±–µ–ª—ã–π 8–º–º', color:'#ffffff', price:480, size:8, group:'–ñ–µ–º—á—É–≥'},
        {id:'ceramic-pink', name:'–ö–µ—Ä–∞–º–∏–∫–∞ —Ä–æ–∑–æ–≤–∞—è 8–º–º', color:'#F7C9D4', price:200, size:8, group:'–ö–µ—Ä–∞–º–∏–∫–∞'},
        {id:'ceramic-beige', name:'–ö–µ—Ä–∞–º–∏–∫–∞ –±–µ–∂–µ–≤–∞—è 8–º–º', color:'#F5E9E2', price:200, size:8, group:'–ö–µ—Ä–∞–º–∏–∫–∞'},
        {id:'ceramic-white', name:'–ö–µ—Ä–∞–º–∏–∫–∞ –±–µ–ª–∞—è 8–º–º', color:'#ffffff', price:200, size:8, group:'–ö–µ—Ä–∞–º–∏–∫–∞'},
        {id:'spacer-gold', name:'–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∑–æ–ª–æ—Ç–æ 4–º–º', color:'#e7d18a', price:120, size:4, group:'–§—É—Ä–Ω–∏—Ç—É—Ä–∞'},
        {id:'heart-gold', name:'–°–µ—Ä–¥–µ—á–∫–æ –∑–æ–ª–æ—Ç–æ 6–º–º', color:'#e1c76d', price:220, size:6, group:'–§—É—Ä–Ω–∏—Ç—É—Ä–∞'},
        {id:'crystal-clear', name:'–ö—Ä–∏—Å—Ç–∞–ª–ª –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π 6–º–º', color:'#e6f4ff', price:280, size:6, group:'–ö—Ä–∏—Å—Ç–∞–ª–ª—ã'}
      ];
      localStorage.setItem(MATERIALS_KEY, JSON.stringify(base));
      return base;
    }
    function saveMaterials(list){ localStorage.setItem(MATERIALS_KEY, JSON.stringify(list)); }
    const beadsList=document.getElementById('beadsList'), addCustomBead=document.getElementById('addCustomBead'), resetMaterials=document.getElementById('resetMaterials');
    function renderMaterials(){
      beadsList.innerHTML='';
      const mats=getMaterials();
      mats.forEach(m=>{
        const b=document.createElement('button'); b.className='bead'; b.type='button';
        const sw=document.createElement('span'); sw.className='sw'; sw.style.background=m.color;
        b.append(sw, document.createTextNode(`${m.name} ‚Ä¢ ${money(m.price)}`));
        b.addEventListener('click',()=>addBead(m.id));
        beadsList.appendChild(b);
      });
    }
    addCustomBead.addEventListener('click',()=>{
      const name=prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–Ω–∞–ø—Ä. –ñ–µ–º—á—É–≥ –ú–∞–π–æ—Ä–∫–∞ 8–º–º):'); if(!name) return;
      const price=Number(prompt('–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç (–≤ ‚Ç∏):','250')||0);
      const size=Number(prompt('–†–∞–∑–º–µ—Ä (–º–º):','8')||8);
      const color=prompt('HEX-—Ü–≤–µ—Ç (–Ω–∞–ø—Ä. #F7C9D4):','#F7C9D4');
      const mats=getMaterials(); mats.push({id:'m-'+crypto.randomUUID().slice(0,8), name, color, price, size, group:'–ú–∞—Ç–µ—Ä–∏–∞–ª'});
      saveMaterials(mats); renderMaterials();
    });
    resetMaterials.addEventListener('click',()=>{
      if(confirm('–°–±—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')){
        localStorage.removeItem(MATERIALS_KEY); renderMaterials();
      }
    });

    // ====== BUILDER (design) ======
    const typeRow=document.getElementById('typeRow'), sizeRow=document.getElementById('sizeRow');
    const strand=document.getElementById('strand');
    const t_type=document.getElementById('t_type'), t_length=document.getElementById('t_length'), t_count=document.getElementById('t_count'), t_price=document.getElementById('t_price');
    const importDesignBtn=document.getElementById('importDesign'), importFile=document.getElementById('importFile'), exportDesignBtn=document.getElementById('exportDesign'), clearDesignBtn=document.getElementById('clearDesign');
    const addDesignToCart=document.getElementById('addDesignToCart'), orderWA=document.getElementById('orderWA'), userNote=document.getElementById('userNote');
    const beadVisualizer=document.querySelector('.visualizer'), progressBar=document.getElementById('progressBar');

    const presets={ keychain:{label:'–ë—Ä–µ–ª–æ–∫', defaultLen:12}, bracelet:{label:'–ë—Ä–∞—Å–ª–µ—Ç', defaultLen:17}, necklace:{label:'–û–∂–µ—Ä–µ–ª—å–µ', defaultLen:40} };
    let design = (()=>{ try{ return JSON.parse(localStorage.getItem(DESIGN_KEY)||'{"type":"bracelet","len":17,"beads":[]}'); }catch(_){ return {type:'bracelet',len:17,beads:[]}; } })();

    function saveDesign(){ localStorage.setItem(DESIGN_KEY, JSON.stringify(design)); }
    function setType(t){ design.type=t; design.len=presets[t]?.defaultLen||design.len; saveDesign(); renderDesign(); highlightChips(); }
    function setLen(t, len){ design.type=t; design.len=len; saveDesign(); renderDesign(); highlightChips(); }
    function addBead(id){ design.beads.push(id); saveDesign(); renderDesign(); }
    function moveBead(i,dir){ const j=i+dir; if(j<0||j>=design.beads.length) return; const tmp=design.beads[i]; design.beads[i]=design.beads[j]; design.beads[j]=tmp; saveDesign(); renderDesign(); }
    function removeBead(i){ design.beads.splice(i,1); saveDesign(); renderDesign(); }
    function calcTotals(){
      const mats=getMaterials();
      const price = design.beads.reduce((s,id)=>s+(mats.find(x=>x.id===id)?.price||0),0);
      const mm = design.beads.reduce((s,id)=>s+(mats.find(x=>x.id===id)?.size||0),0);
      const cmApprox=(mm/10).toFixed(1);
      return {price, mm, cmApprox};
    }
    function renderDesign(){
      strand.innerHTML='';
      beadVisualizer.innerHTML = '';
      const mats=getMaterials();
      const {price, mm, cmApprox}=calcTotals();

      // Render visual beads
      design.beads.forEach((id,idx)=>{
        const m=mats.find(x=>x.id===id);
        const sizePx = m?.size * 2 || 16;
        const color = m?.color || '#ddd';
        
        const beadEl = document.createElement('div');
        beadEl.className = 'visualizer-bead';
        beadEl.style.width = `${sizePx}px`;
        beadEl.style.height = `${sizePx}px`;
        beadEl.style.backgroundColor = color;
        beadEl.style.border = '1px solid #000';
        beadEl.style.marginLeft = `${m?.size}px`;
        
        const infoEl = document.createElement('div');
        infoEl.className = 'visualizer-info';
        infoEl.textContent = `${m?.name || id} (${m?.size} –º–º)`;
        beadEl.append(infoEl);
        
        beadVisualizer.append(beadEl);
      });
      
      // Update progress bar
      const totalWidthPx = beadVisualizer.scrollWidth;
      const targetLengthMm = design.len * 10;
      const progressPercent = Math.min(100, (mm / targetLengthMm) * 100);
      progressBar.style.width = `${progressPercent}%`;

      // Render text beads
      design.beads.forEach((id,idx)=>{
        const m=mats.find(x=>x.id===id);
        const pill=document.createElement('div'); pill.className='bead-pill';
        const sw=document.createElement('span'); sw.className='sw'; sw.style.background=m?.color||'#ddd';
        const name=document.createElement('span'); name.textContent=m?.name||id;
        const act=document.createElement('span'); act.className='pill-actions';
        const left=document.createElement('button'); left.textContent='‚óÄÔ∏è'; left.title='–í–ª–µ–≤–æ'; left.onclick=()=>moveBead(idx,-1);
        const right=document.createElement('button'); right.textContent='‚ñ∂Ô∏è'; right.title='–í–ø—Ä–∞–≤–æ'; right.onclick=()=>moveBead(idx,+1);
        const del=document.createElement('button'); del.textContent='‚úï'; del.title='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=>removeBead(idx);
        act.append(left,right,del); pill.append(sw,name,act); strand.appendChild(pill);
      });
      
      const info=presets[design.type]||{label:design.type};
      t_type.textContent=info.label; t_length.textContent=`${design.len} —Å–º (‚âà${cmApprox} —Å–º —Å–æ–±—Ä–∞–Ω–æ)`; t_count.textContent=String(design.beads.length); t_price.textContent=money(price);
    }
    function highlightChips(){
      [...typeRow.querySelectorAll('.chip')].forEach(c=>c.classList.toggle('active', c.dataset.type===design.type));
      [...sizeRow.querySelectorAll('.chip')].forEach(c=>{
        const [t,l]=c.dataset.size.split(':'); c.classList.toggle('active', t===design.type && Number(l)===Number(design.len));
      });
    }
    typeRow.addEventListener('click',(e)=>{ const b=e.target.closest('.chip'); if(!b) return; setType(b.dataset.type); });
    sizeRow.addEventListener('click',(e)=>{ const b=e.target.closest('.chip'); if(!b) return; const [t,l]=b.dataset.size.split(':'); setLen(t, Number(l)); });

    exportDesignBtn.addEventListener('click',()=>{
      const blob=new Blob([JSON.stringify(design,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='charm-design.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);
    });
    importDesignBtn.addEventListener('click',()=>importFile.click());
    importFile.addEventListener('change',()=>{
      const f=importFile.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); if(!data || !Array.isArray(data.beads)) throw Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç'); design=data; saveDesign(); renderDesign(); highlightChips(); alert('–î–∏–∑–∞–π–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!'); }catch(e){ alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: '+e.message);} }; r.readAsText(f);
    });
    clearDesignBtn.addEventListener('click',()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω?')){ design.beads=[]; saveDesign(); renderDesign(); }});

    // Add design to cart
    addDesignToCart.addEventListener('click', ()=>{
      if(design.beads.length===0){ alert('–î–æ–±–∞–≤—å—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –¥–∏–∑–∞–π–Ω'); return; }
      const {price}=calcTotals();
      addToCart({type:'design', payload:design, name:`–î–∏–∑–∞–π–Ω: ${(presets[design.type]?.label)||design.type} ${design.len} —Å–º`, price:price, qty:1, note:userNote.value||''});
      alert('–î–∏–∑–∞–π–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É üß∫');
    });

    // Order design via WhatsApp
    orderWA.addEventListener('click', ()=>{
      if(design.beads.length===0){ alert('–î–æ–±–∞–≤—å—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –¥–∏–∑–∞–π–Ω'); return; }
      const mats=getMaterials(); const {price, cmApprox}=calcTotals(); const label=(presets[design.type]?.label)||design.type;
      const counts={}; design.beads.forEach(id=>counts[id]=(counts[id]||0)+1);
      const lines=Object.entries(counts).map(([id,c])=>`‚Ä¢ ${(mats.find(m=>m.id===id)?.name||id)} √ó ${c}`).join('%0A');
      const msg=`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ.%0A–¢–∏–ø: ${encodeURIComponent(label)}%0A–î–ª–∏–Ω–∞: ${encodeURIComponent(design.len+' —Å–º (‚âà'+cmApprox+' —Å–º —Å–æ–±—Ä–∞–Ω–æ)')}%0A–°–æ—Å—Ç–∞–≤:%0A${encodeURIComponent(lines)}%0A–ò—Ç–æ–≥: ${encodeURIComponent(money(price))}%0A–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${encodeURIComponent(userNote.value||'')}`;
      window.open(`${WA_URL}?text=${msg}`,'_blank');
    });

    renderMaterials(); highlightChips(); renderDesign();

    // ====== CART ======
    const openCart=document.getElementById('openCart'), closeCart=document.getElementById('closeCart'), cartSection=document.getElementById('cartSection'), cartCount=document.getElementById('cartCount');
    const cartBody=document.getElementById('cartBody'), cartTable=document.getElementById('cartTable'), cartEmpty=document.getElementById('cartEmpty'), cartTotal=document.getElementById('cartTotal');
    const checkoutWA=document.getElementById('checkoutWA'), clearCart=document.getElementById('clearCart');

    function getCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)||'[]'); }catch(_){ return []; } }
    function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderCartBadge(); }
    function renderCartBadge(){ const c=getCart().reduce((s,i)=>s+i.qty,0); cartCount.textContent=String(c); }
    function addToCart(item){ const c=getCart(); 
      if(item.type==='product'){
        const idx=c.findIndex(x=> x.type==='product' && x.id===item.id);
        if(idx>=0){ c[idx].qty += item.qty||1; } else { c.push({type:'product', id:item.id, name:item.name, price:item.price, qty:item.qty||1}); }
      }else if(item.type==='design'){
        c.push({type:'design', payload:item.payload, name:item.name, price:item.price, qty:item.qty||1, note:item.note||''});
      }
      saveCart(c);
    }
    function removeFromCart(i){ const c=getCart(); c.splice(i,1); saveCart(c); renderCart(); }
    function changeQty(i, delta){ const c=getCart(); c[i].qty = Math.max(1, (c[i].qty||1)+delta); saveCart(c); renderCart(); }
    function renderCart(){
      const c=getCart();
      if(c.length===0){ cartEmpty.style.display='block'; cartTable.style.display='none'; cartTotal.textContent=money(0); return; }
      cartEmpty.style.display='none'; cartTable.style.display='table';
      cartBody.innerHTML='';
      let total=0;
      c.forEach((it,i)=>{
        const tr=document.createElement('tr');
        const tdName=document.createElement('td');
        tdName.innerHTML = it.type==='product'
          ? `üì¶ ${it.name}`
          : `‚ú® ${it.name}<br/><span class="muted" style="font-size:12px">${(it.note?'–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: '+it.note:'')}</span>`;
        const tdPrice=document.createElement('td'); tdPrice.textContent=money(it.price);
        const tdQty=document.createElement('td');
        const q=document.createElement('div'); q.className='qty';
        const m=document.createElement('button'); m.textContent='‚àí'; m.onclick=()=>changeQty(i,-1);
        const input=document.createElement('input'); input.type='number'; input.value=it.qty; input.min='1'; input.onchange=()=>{ const v=Math.max(1,parseInt(input.value||'1')); const c=getCart(); c[i].qty=v; saveCart(c); renderCart(); };
        const p=document.createElement('button'); p.textContent='+'; p.onclick=()=>changeQty(i,+1);
        q.append(m,input,p); tdQty.append(q);
        const tdSum=document.createElement('td'); const sum = (it.price||0) * (it.qty||1); total += sum; tdSum.textContent=money(sum);
        const tdDel=document.createElement('td'); const del=document.createElement('button'); del.className='btn btn-outline small'; del.textContent='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=>removeFromCart(i); tdDel.append(del);
        tr.append(tdName,tdPrice,tdQty,tdSum,tdDel); cartBody.appendChild(tr);
      });
      cartTotal.textContent=money(total);
    }
    openCart.addEventListener('click',()=>{ cartSection.style.display='block'; renderCart(); location.hash='#cart'; });
    closeCart.addEventListener('click',()=>{ cartSection.style.display='none'; });
    clearCart.addEventListener('click',()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')){ saveCart([]); renderCart(); }});
    checkoutWA.addEventListener('click',()=>{
      const c=getCart(); if(c.length===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
      let text='–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –≤ Charm Store.%0A%0A';
      c.forEach((it,idx)=>{
        if(it.type==='product'){
          text += `${idx+1}) ${encodeURIComponent(it.name)} ‚Äî ${encodeURIComponent(money(it.price))} √ó ${it.qty}%0A`;
        }else{
          const label=encodeURIComponent(it.name);
          text += `${idx+1}) ${label} ‚Äî ${encodeURIComponent(money(it.price))} √ó ${it.qty}%0A`;
        }
      });
      text += `%0A–ò—Ç–æ–≥–æ: ${encodeURIComponent(cartTotal.textContent)}%0A`;
      window.open(`${WA_URL}?text=${text}`,'_blank');
    });
    renderCartBadge();

    // ====== INITIALIZE CATALOG ======
    seedProducts(); renderCatalog('all');

    // ====== SIMPLE HASH TABS (highlight) ======
    function highlightTabs(){
      const hash=location.hash||'#about';
      document.querySelectorAll('.tabs .tab, footer .tab, .nav a').forEach(a=>{
        const active = a.getAttribute('href')===hash;
        a.classList.toggle('active', active);
      });
    }
    window.addEventListener('hashchange', highlightTabs); highlightTabs();

    // ====== QUICK NAV BUTTONS ======
    document.querySelectorAll('.tabs .tab, footer .tab, .nav a').forEach(a=>{
      a.addEventListener('click',()=>setTimeout(highlightTabs,0));
    });
  </script>
</body>
</html>