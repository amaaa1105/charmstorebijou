<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Charm Store ‚Äî —É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</title>
  <meta name="description" content="Charm Store ‚Äî –Ω–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –ö–∞—Ç–∞–ª–æ–≥ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å–≤–æ–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–¥–µ–ª–∏—è ‚ú®"/>
  <link id="favicon" rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23F7C9D4'/%3E%3Cstop offset='1' stop-color='%23F5E9E2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='128' height='128' fill='url(%23g)'/%3E%3Ctext x='50%25' y='55%25' text-anchor='middle' font-family='Arial' font-size='54' fill='black'%3ECS%3C/text%3E%3C/svg%3E" />
  <style>
    :root{ --pink:#F7C9D4; --beige:#F5E9E2; --white:#fff; --ink:#000;
      --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.08) }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);
         background:linear-gradient(180deg,var(--beige),var(--white) 40%)}
    .container{width:min(1100px,92%);margin:0 auto}

    .btn{border:1px solid #00000030;background:var(--pink);color:var(--ink);
         border-radius:999px;padding:10px 18px;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
    .btn-outline{background:#fff}
    .btn.small{padding:6px 10px;border-radius:8px}

    /* Header */
    .site-header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.75);
                 backdrop-filter:blur(8px);border-bottom:1px solid #00000010}
    .header-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .avatar{width:36px;height:36px;border-radius:50%;border:1px solid #00000030;object-fit:cover;background:#fff}
    .brand-name{margin:0;font-size:20px}
    .brand-tag{margin:0;font-size:12px;opacity:.8}
    .nav{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .nav a, .nav button.link{color:var(--ink);text-decoration:none;padding:8px 12px;border-radius:10px;border:1px solid #00000015;background:#fff}
    .nav a:hover,.nav button.link:hover{background:var(--beige)}

    /* Sections */
    section{scroll-margin-top:80px}
    .hero{padding:34px 0}
    .hero-inner{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:center}
    @media(max-width:900px){.hero-inner{grid-template-columns:1fr}}
    .hero-card{background:var(--white);border:1px solid #00000010;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .hero-img{height:220px;border-radius:10px;border:1px dashed #00000040;background:radial-gradient(100px 100px at 20% 30%, #ffffffcc, transparent), linear-gradient(135deg,var(--pink),var(--beige)); background-size: cover; background-position: center;}
    .section{padding:32px 0}
    .section-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
    .section-head h3{margin:0;font-size:26px}
    .muted{opacity:.8}

    /* Catalog */
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin:0 0 14px}
    .filter-btn{border:1px solid var(--ink);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer}
    .filter-btn.active,.filter-btn:hover{background:var(--beige)}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media(max-width:1000px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:480px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #00000012;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card-img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#fff;border-bottom:1px solid #00000010}
    .card-body{padding:12px;display:flex;flex-direction:column;gap:8px}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .qty{display:inline-flex;align-items:center;border:1px solid #00000030;border-radius:10px;overflow:hidden}
    .qty button{background:#fff;border:0;padding:6px 10px;cursor:pointer}
    .qty input{width:44px;text-align:center;border:0;padding:6px 0}

    /* Constructor */
    .constructor .wrap{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media(max-width:900px){.constructor .wrap{grid-template-columns:1fr}}
    .panel{background:#fff;border:1px solid #00000010;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #00000030;border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer}
    .chip.active,.chip:hover{background:var(--beige)}
    .beads{display:flex;flex-wrap:wrap;gap:8px}
    .bead{display:flex;align-items:center;gap:6px;border:1px solid #00000030;border-radius:999px;padding:6px 10px;background:#fff}
    .bead .sw{width:16px;height:16px;border-radius:50%;border:1px solid #00000040}
    .strand{display:flex;flex-wrap:wrap;gap:8px;min-height:56px;border:1px dashed #00000030;border-radius:12px;padding:10px;background:#fff}
    .bead-pill{display:flex;align-items:center;gap:6px;border:1px solid #00000030;border-radius:999px;padding:6px 8px;background:#fff}
    .pill-actions button{border:1px solid #00000030;background:#fff;border-radius:6px;padding:2px 6px;cursor:pointer}
    .totals{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .badge{border:1px solid #00000030;padding:6px 10px;border-radius:999px;background:#fff}
    .note{font-size:12px;opacity:.8}

    /* SVG Visualizer */
    .viz-wrap{margin-top:10px;border:1px solid #00000015;border-radius:12px;background:#fff}
    .viz-head{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid #00000010}
    .viz{display:block;width:100%;height:300px}
    .progress{height:6px;background:#00000010;border-radius:6px;overflow:hidden;margin:8px 10px}
    .progress > span{display:block;height:100%;background:var(--pink);width:0%}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img id="avatar" class="avatar" alt="–ê–≤–∞—Ç–∞—Ä"/>
        <div>
          <h1 class="brand-name">Charm Store ‚ú®</h1>
          <p class="brand-tag">—É–∫—Ä–∞—à–µ–Ω–∏—è —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ä¢ —Å–æ–∑–¥–∞–≤–∞–π —Å–≤–æ—ë üéÄ</p>
        </div>
      </div>
      <nav class="nav">
        <a href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
        <a href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
        <a href="https://instagram.com/charmstoreekz" target="_blank" rel="noopener">üì∏ Instagram</a>
        <button id="setAvatarBtn" class="link">–ê–≤–∞—Ç–∞—Ä</button>
        <input id="avatarFile" type="file" accept="image/*" hidden/>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" id="home">
      <div class="container hero-inner">
        <div>
          <h2>–ù–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è + –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π ‚ú®</h2>
          <p class="muted">–ë–µ–ª—ã–µ, —Ä–æ–∑–æ–≤—ã–µ –∏ –±–µ–∂–µ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏, –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –°–æ–±–µ—Ä–∏—Ç–µ —Å–≤–æ—ë –æ–∂–µ—Ä–µ–ª—å–µ, –±—Ä–∞—Å–ª–µ—Ç –∏–ª–∏ –±—Ä–µ–ª–æ–∫ ‚Äî –æ–Ω–ª–∞–π–Ω, –∫–∞–∫ –≤–∂–∏–≤—É—é.</p>
          <div class="tabs">
            <a class="tab" href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
            <a class="tab" href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a class="tab" href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
          </div>
        </div>
        <div class="hero-card">
          <div id="heroImg" class="hero-img" role="img" aria-label="–ü–∞—Å—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —É–∫—Ä–∞—à–µ–Ω–∏–π"></div>
        </div>
      </div>
    </section>

    <section class="section" id="about">
      <div class="container">
        <div class="section-head">
          <h3>–û –Ω–∞—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ üéÄ</h3>
          <div class="row">
            <button id="editAboutBtn" class="btn btn-outline small">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>
        <div id="aboutContent" style="line-height:1.6"></div>
      </div>
    </section>

    <section class="section" id="catalog">
      <div class="container">
        <div class="section-head">
          <h3>–ö–∞—Ç–∞–ª–æ–≥ ‚ú®</h3>
          <div class="filters">
            <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
            <button class="filter-btn" data-filter="bracelets">–ë—Ä–∞—Å–ª–µ—Ç—ã</button>
            <button class="filter-btn" data-filter="necklaces">–û–∂–µ—Ä–µ–ª—å—è</button>
            <button class="filter-btn" data-filter="rings">–ö–æ–ª—å—Ü–∞</button>
            <button class="filter-btn" data-filter="earrings">–°–µ—Ä—å–≥–∏</button>
            <button class="filter-btn" data-filter="chains">–¶–µ–ø–æ—á–∫–∏</button>
            <button class="filter-btn" data-filter="keychains">–ë—Ä–µ–ª–∫–∏</button>
          </div>
        </div>
        <div id="productsGrid" class="grid"></div>
        <p id="emptyState" class="muted" style="text-align:center">–ü–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –ø–æ–∑–∂–µ.</p>
      </div>
    </section>

    <section class="section constructor" id="builder">
      <div class="container">
        <div class="section-head">
          <h3>–°–æ–∑–¥–∞–π —Å–≤–æ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ üí´</h3>
          <div class="muted">–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ –ø—Ä–µ–≤—å—é. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏ —É–¥–∞–ª—è—Ç—å.</div>
        </div>

        <div class="wrap">
          <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
          <div class="panel">
            <div class="row" style="margin-bottom:6px"><span class="muted">–¢–∏–ø –∏–∑–¥–µ–ª–∏—è:</span></div>
            <div class="row" id="typeRow">
              <button class="chip" data-type="keychain">–ë—Ä–µ–ª–æ–∫</button>
              <button class="chip" data-type="bracelet">–ë—Ä–∞—Å–ª–µ—Ç</button>
              <button class="chip" data-type="necklace">–û–∂–µ—Ä–µ–ª—å–µ</button>
            </div>

            <div class="row" style="margin:10px 0 6px"><span class="muted">–î–ª–∏–Ω–∞ (—Å–º):</span></div>
            <div class="row" id="sizeRow">
              <button class="chip" data-size="keychain:12">12</button>
              <button class="chip" data-size="bracelet:16">16</button>
              <button class="chip" data-size="bracelet:17">17</button>
              <button class="chip" data-size="bracelet:19">19</button>
              <button class="chip" data-size="necklace:40">40</button>
              <button class="chip" data-size="necklace:45">45</button>
              <button class="chip" data-size="necklace:50">50</button>
            </div>

            <div class="row" style="margin:10px 0 6px"><span class="muted">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span></div>
            <div id="beadsList" class="beads"></div>

            <div class="row" style="margin-top:10px">
              <button id="addCustomBead" class="btn btn-outline small">‚ûï –°–≤–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª</button>
              <button id="resetMaterials" class="btn btn-outline small">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            <p class="note">–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, —Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç). –û–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
          </div>

          <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
          <div class="panel">
            <div class="viz-wrap">
              <div class="viz-head">
                <strong>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–¥–µ–ª–∏—è (–∂–∏–≤–æ–π —Ä–µ–Ω–¥–µ—Ä)</strong>
                <button id="clearDesign" class="btn btn-outline small">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>
              <svg id="viz" class="viz" viewBox="0 0 600 300" aria-label="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–¥–µ–ª–∏—è"></svg>
              <div class="progress"><span id="fillBar"></span></div>
            </div>

            <div id="strand" class="strand" aria-label="–ù–∏—Ç—å —Å –±—É—Å–∏–Ω–∞–º–∏"></div>

            <div class="totals">
              <span class="badge">–¢–∏–ø: <span id="t_type">‚Äî</span></span>
              <span class="badge">–î–ª–∏–Ω–∞: <span id="t_length">‚Äî</span></span>
              <span class="badge">–ë—É—Å–∏–Ω: <span id="t_count">0</span></span>
              <span class="badge">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="t_price">0 ‚Ç∏</span></span>
            </div>

            <label class="row" style="gap:8px;margin-top:8px"><span class="muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</span>
              <input id="userNote" type="text" placeholder="–ù–∞–ø—Ä.: –∑–∞—Å—Ç—ë–∂–∫–∞ –∑–æ–ª–æ—Ç–æ, —Ä–∞–∑–º–µ—Ä 17 —Å–º" style="flex:1;padding:8px 10px;border:1px solid #00000040;border-radius:10px"/>
            </label>

            <div class="row" style="justify-content:flex-end;margin-top:8px;gap:8px">
              <button id="addDesignToCart" class="btn btn-outline">üß∫ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
              <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø WA-–ö–ù–û–ü–ö–ê -->
              <button id="orderWA" class="btn">üì≤ –ó–∞–∫–∞–∑–∞—Ç—å –≤ WhatsApp</button>
            </div>
            <p class="note">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —É ¬´—Ç–∞–±–ª–µ—Ç–æ–∫¬ª –Ω–∏–∂–µ –µ—Å—Ç—å ‚óÄÔ∏è ‚ñ∂Ô∏è –∏ ‚úï –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer" style="border-top:1px solid #00000010;padding:16px 0;background:rgba(255,255,255,.6);margin-top:24px">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <span>¬©Ô∏è <span id="year"></span> Charm Store</span>
      <div>
        <a class="tab" href="#about">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
        <a class="tab" href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a class="tab" href="#builder">–°–æ–∑–¥–∞–π —Å–≤–æ—ë</a>
        <a class="tab" href="https://instagram.com/charmstoreekz" target="_blank" rel="noopener">Instagram</a>
      </div>
    </div>
  </footer>

  <!-- –ú–æ–¥–∞–ª–∫–∏ -->
  <dialog id="aboutModal">
    <form id="aboutForm" method="dialog" style="padding:16px;min-width:min(520px,92vw)">
      <h3 style="margin:0 0 10px">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ¬´–û –º–∞–≥–∞–∑–∏–Ω–µ¬ª</h3>
      <textarea id="aboutInput" rows="8" style="width:100%;padding:10px;border:1px solid #00000030;border-radius:10px"></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:12px">
        <button class="btn btn-outline" value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="saveAbout" class="btn" value="default">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </dialog>

  <script>
    // ====== CONFIG ======
    const YEAR=document.getElementById('year'); YEAR.textContent=new Date().getFullYear();
    const AVATAR_KEY='csAvatar', ABOUT_KEY='csAbout', MATERIALS_KEY='csMaterials', DESIGN_KEY='csDesign', PRODUCTS_KEY='csProducts';
    const WA_NUMBER='77785094161'; // –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –Ω–æ–º–µ—Ä
    const WA_URL=`https://wa.me/${WA_NUMBER}`;

    // ====== AVATAR / HERO / FAVICON ======
    const avatarImg=document.getElementById('avatar'), setAvatarBtn=document.getElementById('setAvatarBtn'), avatarFile=document.getElementById('avatarFile'), favicon=document.getElementById('favicon');
    const heroImg=document.getElementById('heroImg');
    function placeholderSVG(label='CS'){
      const pink=getComputedStyle(document.documentElement).getPropertyValue('--pink').trim();
      const beige=getComputedStyle(document.documentElement).getPropertyValue('--beige').trim();
      const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='320' height='320'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='${pink}'/><stop offset='100%' stop-color='${beige}'/></linearGradient></defs><rect width='320' height='320' rx='28' fill='url(#g)'/><text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Arial, sans-serif' font-size='128' fill='black' opacity='.9'>${label}</text></svg>`;
      return 'data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svg);
    }
    function loadAvatar(){ const a=localStorage.getItem(AVATAR_KEY);
      if(a){ avatarImg.src=a; favicon.href=a; heroImg.style.backgroundImage=`url('${a}')`; }
      else { avatarImg.src=placeholderSVG(); heroImg.style.backgroundImage=`url('${placeholderSVG('Charm Store')}')`; } }
    function saveAvatar(data){ localStorage.setItem(AVATAR_KEY,data); loadAvatar(); }
    setAvatarBtn.addEventListener('click',()=>avatarFile.click());
    avatarFile.addEventListener('change',()=>{ const f=avatarFile.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>saveAvatar(r.result); r.readAsDataURL(f); });
    loadAvatar();

    // ====== ABOUT ======
    const aboutDefault=`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Charm Store ‚Äî —É—é—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ –±–µ–ª—ã—Ö, —Ä–æ–∑–æ–≤—ã—Ö –∏ –±–µ–∂–µ–≤—ã—Ö –æ—Ç—Ç–µ–Ω–∫–∞—Ö ü§çüå∏
–ú—ã —Å–æ–∑–¥–∞—ë–º –Ω–µ–∂–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é –∏ –¥–∞—ë–º –≤–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–±—Ä–∞—Ç—å —Å–≤–æ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ –æ–Ω–ª–∞–π–Ω ‚ú®`;
    const aboutContent=document.getElementById('aboutContent'), aboutModal=document.getElementById('aboutModal'), aboutInput=document.getElementById('aboutInput');
    document.getElementById('editAboutBtn').addEventListener('click',()=>{ aboutInput.value=localStorage.getItem(ABOUT_KEY)||aboutDefault; aboutModal.showModal(); });
    document.getElementById('saveAbout').addEventListener('click',(e)=>{ e.preventDefault(); localStorage.setItem(ABOUT_KEY, aboutInput.value||aboutDefault); aboutModal.close(); renderAbout(); });
    function renderAbout(){ const t=localStorage.getItem(ABOUT_KEY)||aboutDefault; aboutContent.innerText=t; } renderAbout();

    // ====== HELPERS ======
    const money=v=>(v||0).toLocaleString('ru-RU')+' ‚Ç∏';
    function fileToDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }

    // ====== SIMPLE CATALOG SEED (–¥–µ–º–æ) ======
    const grid=document.getElementById('productsGrid'), emptyState=document.getElementById('emptyState');
    const filterBtns=[...document.querySelectorAll('.filter-btn')];
    function getProducts(){ try{ return JSON.parse(localStorage.getItem(PRODUCTS_KEY)||'[]'); }catch(_){ return []; } }
    function saveProducts(list){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(list)); }
    (function seed(){ if(getProducts().length) return; saveProducts([{id:crypto.randomUUID(), name:'Pearl Blossom', price:12000, category:'necklaces', desc:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∂–µ–º—á—É–≥, —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞ –ø–æ–¥ –∑–æ–ª–æ—Ç–æ.', image:placeholderSVG('–§–æ—Ç–æ')}]); })();
    function productCard(p){ const el=document.createElement('article'); el.className='card';
      const img=document.createElement('img'); img.className='card-img'; img.src=p.image||placeholderSVG('–§–æ—Ç–æ'); img.alt=p.name;
      const body=document.createElement('div'); body.className='card-body';
      body.innerHTML=`<div style="font-weight:600">${p.name}</div><div style="font-weight:600">${money(p.price)}</div><div class="muted">${p.desc||''}</div>`;
      el.append(img,body); return el; }
    function renderCatalog(filter='all'){ const list=getProducts(); grid.innerHTML='';
      const shown=list.filter(p=> filter==='all'?true:p.category===filter);
      emptyState.style.display=shown.length?'none':'block'; shown.forEach(p=>grid.appendChild(productCard(p))); }
    filterBtns.forEach(b=> b.addEventListener('click',()=>{ filterBtns.forEach(x=>x.classList.remove('active')); b.classList.add('active'); renderCatalog(b.dataset.filter); }));
    renderCatalog('all');

    // ====== MATERIALS ======
    const MATERIALS_BASE=[
      {id:'pearl-6', name:'–ñ–µ–º—á—É–≥ 6–º–º', color:'#f7f3f0', price:350, size:6},
      {id:'pearl-8', name:'–ñ–µ–º—á—É–≥ 8–º–º', color:'#f3ede9', price:450, size:8},
      {id:'pearl-pink', name:'–ñ–µ–º—á—É–≥ —Ä–æ–∑–æ–≤—ã–π 6–º–º', color:'#F7C9D4', price:400, size:6},
      {id:'pearl-white', name:'–ñ–µ–º—á—É–≥ –±–µ–ª—ã–π 8–º–º', color:'#ffffff', price:480, size:8},
      {id:'ceramic-pink', name:'–ö–µ—Ä–∞–º–∏–∫–∞ —Ä–æ–∑–æ–≤–∞—è 8–º–º', color:'#F7C9D4', price:200, size:8},
      {id:'ceramic-beige', name:'–ö–µ—Ä–∞–º–∏–∫–∞ –±–µ–∂–µ–≤–∞—è 8–º–º', color:'#F5E9E2', price:200, size:8},
      {id:'ceramic-white', name:'–ö–µ—Ä–∞–º–∏–∫–∞ –±–µ–ª–∞—è 8–º–º', color:'#ffffff', price:200, size:8},
      {id:'spacer-gold', name:'–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∑–æ–ª–æ—Ç–æ 4–º–º', color:'#e1c76d', price:120, size:4},
      {id:'heart-rose', name:'–°–µ—Ä–¥—Ü–µ –∫–µ—Ä–∞–º–∏–∫–∞ 10–º–º', color:'#f5c6cf', price:260, size:10},
      {id:'crystal-clear', name:'–ö—Ä–∏—Å—Ç–∞–ª–ª –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π 6–º–º', color:'#e6f4ff', price:280, size:6}
    ];
    function getMaterials(){ try{ const s=localStorage.getItem(MATERIALS_KEY); if(s) return JSON.parse(s); }catch(_){}
      localStorage.setItem(MATERIALS_KEY, JSON.stringify(MATERIALS_BASE)); return [...MATERIALS_BASE]; }
    function saveMaterials(list){ localStorage.setItem(MATERIALS_KEY, JSON.stringify(list)); }
    const beadsList=document.getElementById('beadsList'), addCustomBead=document.getElementById('addCustomBead'), resetMaterials=document.getElementById('resetMaterials');
    function renderMaterials(){ beadsList.innerHTML=''; getMaterials().forEach(m=>{ const b=document.createElement('button'); b.className='bead'; b.type='button';
      const sw=document.createElement('span'); sw.className='sw'; sw.style.background=m.color; b.append(sw, document.createTextNode(`${m.name} ‚Ä¢ ${money(m.price)}`));
      b.addEventListener('click',()=>addBead(m.id)); beadsList.appendChild(b); }); }
    addCustomBead.addEventListener('click',()=>{
      const name=prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:'); if(!name) return;
      const price=Number(prompt('–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç (‚Ç∏):','250')||0);
      const size=Number(prompt('–†–∞–∑–º–µ—Ä (–º–º):','8')||8);
      const color=prompt('HEX-—Ü–≤–µ—Ç:','#F7C9D4');
      const mats=getMaterials(); mats.push({id:'m-'+crypto.randomUUID().slice(0,8), name, color, price, size}); saveMaterials(mats); renderMaterials();
    });
    resetMaterials.addEventListener('click',()=>{ if(confirm('–°–±—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')){ localStorage.removeItem(MATERIALS_KEY); renderMaterials(); }});
    renderMaterials();

    // ====== DESIGN STATE ======
    const presets={ keychain:{label:'–ë—Ä–µ–ª–æ–∫', defaultLen:12}, bracelet:{label:'–ë—Ä–∞—Å–ª–µ—Ç', defaultLen:17}, necklace:{label:'–û–∂–µ—Ä–µ–ª—å–µ', defaultLen:40} };
    let design = (()=>{ try{ return JSON.parse(localStorage.getItem(DESIGN_KEY)||'{"type":"keychain","len":12,"beads":[]}'); }catch(_){ return {type:'keychain',len:12,beads:[]}; } })();
    const typeRow=document.getElementById('typeRow'), sizeRow=document.getElementById('sizeRow'), strand=document.getElementById('strand');
    const t_type=document.getElementById('t_type'), t_length=document.getElementById('t_length'), t_count=document.getElementById('t_count'), t_price=document.getElementById('t_price');
    const clearDesignBtn=document.getElementById('clearDesign'), orderWA=document.getElementById('orderWA'), addDesignToCart=document.getElementById('addDesignToCart'), userNote=document.getElementById('userNote');
    const viz=document.getElementById('viz'), fillBar=document.getElementById('fillBar');

    function saveDesign(){ localStorage.setItem(DESIGN_KEY, JSON.stringify(design)); }
    function setType(t){ design.type=t; design.len=presets[t]?.defaultLen||design.len; saveDesign(); render(); highlightChips(); }
    function setLen(t,len){ design.type=t; design.len=len; saveDesign(); render(); highlightChips(); }
    function addBead(id){ design.beads.push(id); saveDesign(); render(); }
    function moveBead(i,dir){ const j=i+dir; if(j<0||j>=design.beads.length) return; [design.beads[i],design.beads[j]]=[design.beads[j],design.beads[i]]; saveDesign(); render(); }
    function removeBead(i){ design.beads.splice(i,1); saveDesign(); render(); }

    typeRow.addEventListener('click',e=>{ const b=e.target.closest('.chip'); if(!b) return; setType(b.dataset.type); });
    sizeRow.addEventListener('click',e=>{ const b=e.target.closest('.chip'); if(!b) return; const [t,l]=b.dataset.size.split(':'); setLen(t, Number(l)); });
    clearDesignBtn.addEventListener('click',()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω?')){ design.beads=[]; saveDesign(); render(); }});

    // ====== RENDER PILLS (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ) ======
    function renderPills(){
      strand.innerHTML='';
      const mats=getMaterials();
      design.beads.forEach((id,idx)=>{
        const m=mats.find(x=>x.id===id)||{name:id,color:'#ddd'};
        const pill=document.createElement('div'); pill.className='bead-pill';
        const sw=document.createElement('span'); sw.className='sw'; sw.style.background=m.color;
        const name=document.createElement('span'); name.textContent=m.name;
        const act=document.createElement('span'); act.className='pill-actions';
        const left=document.createElement('button'); left.textContent='‚óÄÔ∏è'; left.title='–í–ª–µ–≤–æ'; left.onclick=()=>moveBead(idx,-1);
        const right=document.createElement('button'); right.textContent='‚ñ∂Ô∏è'; right.title='–í–ø—Ä–∞–≤–æ'; right.onclick=()=>moveBead(idx,+1);
        const del=document.createElement('button'); del.textContent='‚úï'; del.title='–£–¥–∞–ª–∏—Ç—å'; del.onclick=()=>removeBead(idx);
        act.append(left,right,del); pill.append(sw,name,act); strand.appendChild(pill);
      });
    }

    // ====== SVG VISUALIZER ======
    function drawVisualizer(){
      const mats=getMaterials();
      // –æ—á–∏—Å—Ç–∫–∞
      while(viz.firstChild) viz.removeChild(viz.firstChild);

      // —Ñ–æ–Ω
      const bg=document.createElementNS('http://www.w3.org/2000/svg','rect');
      bg.setAttribute('x','0'); bg.setAttribute('y','0'); bg.setAttribute('width','600'); bg.setAttribute('height','300'); bg.setAttribute('fill','#fff');
      viz.appendChild(bg);

      if(design.type==='keychain'){
        // –∫–∞—Ä–∞–±–∏–Ω (–ø—Ä–æ—Å—Ç–∞—è –∏–∫–æ–Ω–∫–∞)
        const clipGroup=document.createElementNS('http://www.w3.org/2000/svg','g');
        clipGroup.setAttribute('transform','translate(300,25)');
        const ring=document.createElementNS('http://www.w3.org/2000/svg','circle');
        ring.setAttribute('cx','0'); ring.setAttribute('cy','25'); ring.setAttribute('r','12'); ring.setAttribute('fill','#e9d492'); ring.setAttribute('stroke','#ad9655'); ring.setAttribute('stroke-width','2');
        const hook=document.createElementNS('http://www.w3.org/2000/svg','path');
        hook.setAttribute('d','M -8 10 Q 0 -10 8 10 L 6 18 Q 0 8 -6 18 Z');
        hook.setAttribute('fill','#e9d492'); hook.setAttribute('stroke','#ad9655'); hook.setAttribute('stroke-width','1.5');
        clipGroup.append(hook,ring); viz.appendChild(clipGroup);

        // —à–Ω—É—Ä
        const cord=document.createElementNS('http://www.w3.org/2000/svg','rect');
        cord.setAttribute('x','298'); cord.setAttribute('y','49'); cord.setAttribute('width','4'); cord.setAttribute('height','190'); cord.setAttribute('rx','2'); cord.setAttribute('fill','#F7C9D4');
        viz.appendChild(cord);

        // —Å—Ç–µ–∫ –±—É—Å–∏–Ω –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
        let y=70;
        design.beads.forEach(id=>{
          const m=mats.find(x=>x.id===id);
          const r=(m?.size||8); // px —Ä–∞–¥–∏—É—Å ‚âà —Ä–∞–∑–º–µ—Ä
          const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
          c.setAttribute('cx','300'); c.setAttribute('cy',String(y+r)); c.setAttribute('r',String(r));
          c.setAttribute('fill', m?.color||'#ddd'); c.setAttribute('stroke','#00000022'); c.setAttribute('stroke-width','1');
          viz.appendChild(c);
          y += r*2 + 6;
        });

        // –ø–µ—Ç–ª—è
        const loop=document.createElementNS('http://www.w3.org/2000/svg','path');
        loop.setAttribute('d','M300 250 q -10 20 0 30 q 10 -10 0 -30 Z');
        loop.setAttribute('fill','#F7C9D4'); viz.appendChild(loop);
      } else {
        // –∫—Ä—É–≥–æ–≤–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è –±—Ä–∞—Å–ª–µ—Ç–∞/–æ–∂–µ—Ä–µ–ª—å—è
        const centerX=300, centerY=150;
        const radius = design.type==='bracelet' ? 90 : 120;
        // –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–π –∫–æ–Ω—Ç—É—Ä
        const guide=document.createElementNS('http://www.w3.org/2000/svg','circle');
        guide.setAttribute('cx',centerX); guide.setAttribute('cy',centerY); guide.setAttribute('r',radius);
        guide.setAttribute('fill','none'); guide.setAttribute('stroke','#00000010'); guide.setAttribute('stroke-dasharray','4 6');
        viz.appendChild(guide);

        const total=design.beads.length;
        let angle=-90; // —Å–≤–µ—Ä—Ö—É
        const step = total? 360/total : 0;

        design.beads.forEach(id=>{
          const m=mats.find(x=>x.id===id);
          const rad=(m?.size||8);
          const x = centerX + (radius * Math.cos(angle * Math.PI/180));
          const y = centerY + (radius * Math.sin(angle * Math.PI/180));
          const bead=document.createElementNS('http://www.w3.org/2000/svg','circle');
          bead.setAttribute('cx',x); bead.setAttribute('cy',y); bead.setAttribute('r',rad);
          bead.setAttribute('fill',m?.color||'#ddd'); bead.setAttribute('stroke','#00000022'); bead.setAttribute('stroke-width','1');
          viz.appendChild(bead);
          angle += step;
        });

        // –∑–∞–º–æ—á–µ–∫
        const clasp=document.createElementNS('http://www.w3.org/2000/svg','rect');
        clasp.setAttribute('x',centerX-10); clasp.setAttribute('y',centerY-radius-6); clasp.setAttribute('width','20'); clasp.setAttribute('height','12');
        clasp.setAttribute('rx','3'); clasp.setAttribute('fill','#e9d492'); clasp.setAttribute('stroke','#ad9655');
        viz.appendChild(clasp);
      }
    }

    // ====== TOTALS & BAR ======
    function calcTotals(){
      const mats=getMaterials();
      const price = design.beads.reduce((s,id)=>s+(mats.find(x=>x.id===id)?.price||0),0);
      const mm = design.beads.reduce((s,id)=>s+(mats.find(x=>x.id===id)?.size||0),0);
      const cmApprox=(mm/10).toFixed(1);
      return {price, mm, cmApprox};
    }
    function renderTotals(){
      const {price, mm, cmApprox}=calcTotals();
      t_type.textContent=presets[design.type]?.label||design.type;
      t_length.textContent=`${design.len} —Å–º (‚âà${cmApprox} —Å–º —Å–æ–±—Ä–∞–Ω–æ)`;
      t_count.textContent=String(design.beads.length);
      t_price.textContent=money(price);
      const target=design.len*10;
      fillBar.style.width = Math.min(100, (mm/target)*100) + '%';
    }

    function highlightChips(){
      [...typeRow.querySelectorAll('.chip')].forEach(c=>c.classList.toggle('active', c.dataset.type===design.type));
      [...sizeRow.querySelectorAll('.chip')].forEach(c=>{
        const [t,l]=c.dataset.size.split(':'); c.classList.toggle('active', t===design.type && Number(l)===Number(design.len));
      });
    }

    function render(){ renderPills(); drawVisualizer(); renderTotals(); }
    highlightChips(); render();

    // ====== SAVE DESIGN (–ª–æ–∫–∞–ª—å–Ω–æ) ======
    addDesignToCart.addEventListener('click',()=>{
      const blob=new Blob([JSON.stringify(design,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download='charm-design.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);
    });

    // ====== SINGLE WhatsApp ACTION ======
    orderWA.addEventListener('click', ()=>{
      if(design.beads.length===0){ alert('–î–æ–±–∞–≤—å—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤ –¥–∏–∑–∞–π–Ω'); return; }
      const mats=getMaterials(); const {price, cmApprox}=calcTotals(); const label=(presets[design.type]?.label)||design.type;
      const counts={}; design.beads.forEach(id=>counts[id]=(counts[id]||0)+1);
      const lines=Object.entries(counts).map(([id,c])=>{
        const n=mats.find(m=>m.id===id)?.name||id; return `‚Ä¢ ${n} √ó ${c}`;
      }).join('%0A');
      const msg=`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏–∑–¥–µ–ª–∏–µ.%0A–¢–∏–ø: ${encodeURIComponent(label)}%0A–î–ª–∏–Ω–∞: ${encodeURIComponent(design.len+' —Å–º (‚âà'+cmApprox+' —Å–º —Å–æ–±—Ä–∞–Ω–æ)')}%0A–°–æ—Å—Ç–∞–≤:%0A${encodeURIComponent(lines)}%0A–ò—Ç–æ–≥: ${encodeURIComponent(money(price))}%0A–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${encodeURIComponent(userNote.value||'')}`;
      window.open(`${WA_URL}?text=${msg}`,'_blank');
    });
  </script>
</body>
</html>